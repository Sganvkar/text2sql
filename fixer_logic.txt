# -------------------------------------------------------------------
# Fixer templates
# -------------------------------------------------------------------

FIX_PROMPT = """
You are a Microsoft SQL Server expert. The following SQL query failed when executed.

Original user question:
{question}

SQL query that failed:
{sql_query}

Error message:
{error}

Database schema:
{schema}

Your task:
- Correct the SQL query so it runs successfully on Microsoft SQL Server.
- Use only the tables/columns listed in the schema above.
- Keep the intent of the user question.
- Do NOT wrap the query in backticks or ```sql blocks.
- Ensure it is valid T-SQL syntax for Microsoft SQL Server.
- Only return the corrected SQL query, nothing else.
"""




# if attempt < FIXER_MAX_RETRIES - 1:
            #     logging.info("Sending query and error back to model for correction...")

            #     # Fix query with schema injected
            #     fixed_sql = generator.invoke(
            #         FIX_PROMPT.format(
            #             question=question,
            #             sql_query=sql_query,
            #             error=str(e),
            #             schema=schema_str
            #         )
            #     )

            #     # Clean up any backticks or markdown
            #     sql_query = clean_sql(fixed_sql)

            #     logging.info(f"Fixed SQL from generator:\n{sql_query}\n")
            # else:
            #     logging.error("All retries failed. Final failed SQL:\n" + sql_query)
            #     return "Answer not found."